<!DOCTYPE html>
<html>
	<head>
		<title>Storyboard 3D</title>

		<meta name="viewport" content="width=device-width, initial-scale=1">
		<meta http-equiv="Content-Type" content="text/html;charset=utf-8" />

		<!--<link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />-->
		<link rel="stylesheet" href="css/jquery.mobile-1.4.5.min.css" />
		<link rel="stylesheet" href="css/icons.css">
		<link rel="stylesheet" href="css/jqm-docs.css">
		<link rel="stylesheet" href="jqm-iscrollview/lib/jquery.mobile.iscrollview.css"/>
		<link rel="stylesheet" href="jqm-iscrollview/lib/jquery.mobile.iscrollview-pull.css"/>
		<link href='css/jquery.gridly.css' rel='stylesheet' type='text/css'>
		<link href="css/jquery-mobile-fluid960.min.css" />
		<!--<link href='css/sample.css' rel='stylesheet' type='text/css'>-->

		<!--<script src="http://code.jquery.com/jquery-1.7.1.min.js"></script>-->
		<!--<script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>-->
		<!--<script src="js/jquery-1.7.1.min.js"></script>-->
		<!--<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.0/jquery.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.10.3/jquery-ui.min.js"></script>-->

		<script src="js/jquery.min.js"></script>
		<script src="js/jquery-ui.min.js"></script>

		<script src="js/jquery.mobile-1.4.5.min.js"></script>
		<script src="js/three.js"></script>
		<script src="js/controls/OrbitControls.js"></script>
		<script src="js/Projector.js"></script>
		<script src="js/ColladaLoader.js"></script>
		<script src="js/three_lambertoon_b.js"></script> <!--LAMBERTS BECOME LAMBERTOONS-->
		<script type="text/javascript" src="jscolor/jscolor.js"></script>
		<script src="iscroll-4/src/iscroll.js"></script>
		<script src="jqm-iscrollview/lib/jquery.mobile.iscrollview.js"></script>
		
		<script type="text/JavaScript" src="js/shapeshift/core/vendor/jquery.touch-punch.min.js"></script>
		<script type="text/JavaScript" src="js/shapeshift/core/jquery.shapeshift.js"></script>
		<script type="text/JavaScript" src="js/sketch.js"></script>

		<script>
			/* GLOBAL VARIABLES */
			var selectedShot;
		</script>

	</head>
	<body>
		<div data-role="page" id="sequencePage">
			<div data-role="header" data-theme="b" style="background-color:#333">
				<h1>Sequence 1</h1>
			</div>
				<div data-role="tabs" style="padding:0">
					<div data-role="navbar" data-theme="b">
						<ul data-theme="b">
							<li><a href="#sequenceEdit" class="ui-btn-active">Edit mode</a></li>
							<li><a href="#sequenceView" onclick="updateStoryboard()">View mode</a></li>
	 						<li><a href="#sequenceProperties">Defaults</a></li>
						</ul>
					</div><!-- /navbar -->
					<style>


						.drag {
							
						}
						.container {
							position: relative;
							width: 100%;
							margin-top:20px;
						}

						.container > div {
							height: 172px;
							position: absolute;
							width: 240px;
							background-color: #ddd;
						}

						.container img {
							width:100%;
						}
						.container input {
							position:relative;
							margin:0px;
						}
						.container a:hover {
							
						}
						.trashIcon {
							width:24px;
							height:24px;
							opacity:0.5;
						}
						.addIcon {
							width:24px;
							height:24px;
							opacity:0.5;
						}
						.editIcon {
							width:24px;
							height:24px;
							opacity:0.5;
						}
						.shotIndex {
							position:absolute;
							top:0.5em;
							left:0.5em;
							font-weight: bold;
						}
						#storyboardGrid img {
							display:block;
							width:90%;
							margin-left: auto;
    						margin-right: auto;
    						margin-top:1em;
    						border:solid 1px;
    						border-color:#999;
						}
						.shotDescription {
							display:block;
							margin:1em;
							border:solid 1px;
							border-color:#eee;
							padding:0.5em;
						}
					</style>
					
					<div id="sequenceEdit">
						<div class="container">
							<div class="drag" id="bareThumb">
								<div class="shotIndex"><span>1.</span><span>X</span></div>
								<img src="jpg/0.png"/>
								<div class="ui-grid-b">
									<div class="ui-block-a" onclick="">
										<a href="#" onclick="removeShot($(this).parent().parent().parent().attr('data-order'))"><img class="trashIcon" src="css/svg/trash.svg"/>
									</div>
									<div class="ui-block-b">
										<a href="#shotPage" onclick="selectedShot = $(this).parent().parent().parent().attr('data-order')"><img class="editIcon" src="css/svg/pencil.svg"/></a>
									</div>
									<div class="ui-block-c">
										<a href="#" onclick="duplicateShot($(this).parent().parent().parent().attr('data-order'))"><img class="addIcon" src="css/svg/plus.svg"/></a>
									</div>
								</div>
							</div>
							<div id="addShot">
								<div class="shotIndex"><b>NEW</b></div>
								<img style="opacity:0.2" src="jpg/0.png"/>
								<div class="ui-grid-b">
									<div class="ui-block-a" onclick="">
										<a href="#" onclick="selectedShot = $(this).parent().parent().parent().attr('data-order');shotSet.push(new ShotObj());updateSequence();"><img class="addIcon" src="css/svg/plus1.svg"/></a>
									</div>
									<div class="ui-block-b" onclick="">
										<a href="#shotPage" onclick="shotSet.push(new ShotObj());"><img class="addIcon" src="css/svg/plus3.svg"/></a>
									</div>
									<div class="ui-block-c" onclick="">
										<a href="#newMultipleTemplate" data-rel="popup"><img class="addIcon" src="css/svg/plus2.svg"/></a>
									</div>
								</div>
								
								<!-- onclick="shotSet.push(new ShotObj(null,null,null,null,null,null,null));$('.container').trigger('ss-rearrange')" -->
							</div>
						</div>
						<div data-role="popup" id="newMultipleTemplate" style="padding:1em">
							<p>Sorry!</p>
							<p>Adding multiple shots from scenario templates<br>is not available in this prototype.</p>
							<input type="button" value="Go back" onclick="$('#newMultipleTemplate').popup('close')">
						</div>
						<div data-role="footer" data-position="fixed" data-tap-toggle="false">
							<p style="padding-left:12px;font-weight: normal; display:block;"><img src="css/svg/lighting.svg" style="padding-right:12px;" width="24" height="24"/>Drag shots to reorder. Use buttons below each shot to delete, edit or duplicate shot.</p>
						</div>
					</div>
					<div id="sequenceView">
						<div class="ui-grid-b" id="storyboardGrid">
							<div class="ui-block-a" id="cel0">
								<img src="http://placehold.it/160x90">
								<div class="shotDescription"><b>1.1 </b><span id="descTxt">...</span></div>
							</div>
							<div class="ui-block-b" id="cel1">
								<img src="http://placehold.it/160x90">
								<div class="shotDescription"><b>1.2 </b><span id="descTxt">...</span></div>
							</div>
							<div class="ui-block-c" id="cel2">
								<img src="http://placehold.it/160x90">
								<div class="shotDescription"><b>1.3 </b><span id="descTxt">...</span></div>
							</div>
							<div class="ui-block-a" id="cel3">
								<img src="http://placehold.it/160x90">
								<div class="shotDescription"><b>1.4 </b><span id="descTxt">...</span></div>
							</div>
							<div class="ui-block-b" id="cel4">
								<img src="http://placehold.it/160x90">
								<div class="shotDescription"><b>1.5 </b><span id="descTxt">...</span></div>
							</div>
							<div class="ui-block-c" id="cel5">
								<img src="http://placehold.it/160x90">
								<div class="shotDescription"><b>1.6 </b><span id="descTxt">...</span></div>
							</div>
						</div>
						<div data-role="footer" data-position="fixed" data-tap-toggle="false">
							<div data-role="navbar" data-iconpos="bottom" style="margin:-1em;">
					            <ul>
					                <li style="width:35%"><a href="#" data-icon="action">Export...</a></li>
					                <li style="width:35%"><a href="#" data-icon="grid" onclick="window.print()">Print...</a></li>
					            </ul>
					        </div><!-- /navbar -->
						</div>						
					</div>
					<div id="sequenceProperties">
						<p style="margin-left:3em; margin-top:3em">This is where the defaults for new shots will be set.<p>
						<p style="margin-left:3em">This function is not a part of this prototype.</p>
					</div>
					<script>

						var defThumb = $('#bareThumb')[0].outerHTML;
						var addThumb = $('#addShot')[0].outerHTML;

						$(document).on("pagecreate",function(event){
							
						});

						$(document).click(function() {
							$(".container").trigger("ss-rearrange");
						});

						$(".container").on("ss-arranged", function(e) { 
							$(this).children().each(function() {
								$(this).children(0).first().children(0).eq(1).html(($(this).index()+1));
								$(this).attr("data-order",$(this).index());
								$(this).attr("onclick","selectedShot = $(this).index();");

								if(shotSet[$(this).index()] != undefined){
									$(this).children('img').attr("src",shotSet[$(this).index()].thumb);
								}
								
							});
						});

						$(document).ready(function(){

							$('#bareThumb').remove();
							$('#addShot').remove();

							createSequence(0);

							$(".container").shapeshift({
								dragWhitelist: ".drag",
								colWidth: 240,
								animated:false
							});
							for(var i=0; i<shotSet.length; i++){
								$(".container").append(defThumb);
							}
							$(".container").append(addThumb);
							$(".container").trigger("ss-rearrange");
							$(".container").shapeshift({dragWhitelist: ".drag",animated:false});
						});

						var updateSequence = function() {
							$(".container").html("");
							for(var i=0; i<shotSet.length; i++){
								$(".container").append(defThumb);
							}
							$(".container").append(addThumb);
							$(".container").trigger("ss-rearrange");
							$(".container").shapeshift({dragWhitelist: ".drag",animated:false});
							console.log("Sequence updated to include all current shots");
						};

						$( "#sequencePage" ).on( "pageshow", function( event ) {
							console.log("#sequencePage pageshow event fired");
							updateSequence();
						} );

						var removeShot = function(which) {
							console.log("Removing shot " + which);
							shotSet.splice(which,1);
							updateSequence();
						};

						var duplicateShot = function(which) {
							console.log("Duplicating shot " + which);
							var tempShot = shotSet[which];
							shotSet.splice(which, 0, tempShot);
							updateSequence();
						}

						var updateStoryboard = function() {
							for(var i=0;i<6;i++) {
								$('#cel' + i).children(0).eq(0).attr("src","jpg/16x9.png");
								$('#cel' + i).children(0).eq(1).children(0).eq(1).html("");
							}
							for(var i=0;i<shotSet.length;i++) {
								$('#cel' + i).children(0).eq(0).attr("src",shotSet[i].thumb);
								$('#cel' + i).children(0).eq(1).children(0).eq(1).html(shotSet[i].scriptobj);
							}
						};
						
					</script>
				</div>

		</div>

		<div data-role="page" id="shotPage">

			<div data-role="header">
				<!--fixed header if needed-->
			</div>
			
			<div data-role="content" style="padding-bottom:0px">

				<!-- SHOT PREVIEW PAGE -->
				<!-- The main canvas gets appended here. Any additional elements will appear below it -->
				<div id="shotPrevPage" class="content-primary" data-theme="b">

					<div style="height:1em;background-color:#333" id="topBorder">
						
					</div>
					<div id="statusOverlay">
						Free camera<br>
						<span>drag to adjust view<span>
					</div>
					<style>
						#textarea {
							height: auto;
						}
						#scriptContainer {
							height:auto;
							
							padding-left:1em;
							padding-right:1em;
						}
						#shotPrevPage {
							
						}
					</style>

					<div id="bottomBorder" style="background-color:#333;margin-top:-5px;height:100%;height:1em">
						
					</div>

					<div style="position:fixed;right:1em;bottom:1em;display:none" id="footbar">
						<a href="#" data-ui-btn>Show Script</a>
					</div>

					<script>
						//var grabContainer = $(".container")[0].outerHTML;
						//$("#shotPrevPage").append(grabContainer);
					</script>

				</div><!-- /page -->

				<div id="drawingDiv">
					<style>
						#drawingDiv {
							float:right;
							background-color: #999;
						}
					</style>
					<canvas id="simple_sketch">
				</div>

<!-- BEGIN PANEL HACK -->

				<script>

					$(document).ready(function(){
						var menuPage = $('#shotMenuPage');
						var presetPage = $('#shotPresetPage');
						var cameraPage = $('#shotCameraPage');
						var lightingPage = $('#shotLightingPage');
						var stagePage = $('#shotStagePage');
						var castPage = $('#shotCastPage');
						var actingPage = $('#shotActingPage');
						var propsPage = $('#shotPropsPage');
						var scriptPage = $('#shotScriptPage');
						var advancedPage = $('#shotAdvancedPage');

						presetPage.hide();
						cameraPage.hide();
						lightingPage.hide();
						stagePage.hide();
						castPage.hide();
						actingPage.hide();
						propsPage.hide();
						scriptPage.hide();
						advancedPage.hide();

						$('#drawingDiv').hide();
						$('#shotSketchPage').hide();

						(function ($) {
					    	$.each(['show', 'hide'], function (i, ev) {
					    		var el = $.fn[ev];
					    		$.fn[ev] = function () {
					    			this.trigger(ev);
					    			return el.apply(this, arguments);
					    		};
					    	});
					    })(jQuery);

						/*$(".smallContainer").shapeshift({
							dragWhitelist: ".drag"
						});*/
					});

				</script>

<!-- END PANEL HACK -->

				<!-- SHOT MENU PAGE -->
				<div id="shotMenuPage" class="content-secondary">

					<!--<div style="height:1em;width:1em;background-color:#333;margin:-1em;"></div>-->
					<!--<div style="width:0;height:0;border-top: 0.5em solid #333;border-bottom: 0.5em solid transparent;border-left: 0.5em solid #333;border-right: 0.5em solid transparent;margin:-1em"></div>-->
					<div data-role="header" id="shotMenuHeader">
						<!--<a href="#sequencePage" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all" data-rel="close" onclick="shotSet[selectedShot] = saveMessToShot(); shotSet[selectedShot].thumb = threeCanvas.toDataURL()">Back</a>-->
					    <h1 id="shotHeader">Shot 1.X</h1>
					</div>

					<p></p><!--quick way to add some padding visually-->

					<ul data-role="listview" id="menuListview">
						<li data-icon="arrow-l" data-theme="b"><a href="#sequencePage" onclick="shotSet[selectedShot] = saveMessToShot(); shotSet[selectedShot].thumb = threeCanvas.toDataURL(); shotSet[selectedShot].scriptobj = $('#textbox-Script').val();">Back to sequence</a></li>
						<li data-role="list-divider"></li>
						<li class="ui-icon-preset ui-nodisc-icon" data-icon="preset"><a href="#shotPresetPage" data-rel="popup" onclick="$('#shotMenuPage').hide();$('#shotPresetPage').show()">Preset</a></li>
						<li class="ui-icon-camera ui-nodisc-icon" data-icon="camera"><a href="#shotCameraPage" data-rel="popup" onclick="$('#shotMenuPage').hide();$('#shotCameraPage').show()">Camera</a></li>
						<li class="ui-icon-lighting ui-nodisc-icon" data-icon="lighting"><a href="#shotLightingPage" data-rel="popup" onclick="$('#shotMenuPage').hide();$('#shotLightingPage').show()">Lighting</a></li>
						<li class="ui-icon-stage ui-nodisc-icon" data-icon="stage"><a href="#shotStagePage" data-rel="popup" onclick="$('#shotMenuPage').hide();$('#shotStagePage').show()">Stage</a></li>
						<li class="ui-icon-cast ui-nodisc-icon" data-icon="cast"><a href="#shotCastPage" data-rel="popup" onclick="$('#shotMenuPage').hide();$('#shotCastPage').show()">Cast</a></li>
						<li class="ui-icon-acting ui-nodisc-icon" data-icon="acting"><a href="#shotActingPage" data-rel="popup" onclick="$('#shotMenuPage').hide();$('#shotActingPage').show()">Acting</a></li>
						<li class="ui-icon-props ui-nodisc-icon" data-icon="props"><a href="#shotPropsPage" data-rel="popup" onclick="$('#shotMenuPage').hide();$('#shotPropsPage').show()">Props</a></li>
						<li class="ui-icon-script ui-nodisc-icon" data-icon="script"><a href="#shotScriptPage" data-rel="popup" onclick="$('#shotMenuPage').hide();$('#shotScriptPage').show()">Script</a></li>
						<li class="ui-icon-advanced ui-nodisc-icon" data-icon="advanced"><a href="#shotAdvancedPage" data-rel="popup" onclick="$('#shotMenuPage').hide();$('#shotAdvancedPage').show()">Advanced</a></li>
					</ul>

					<div id="mobileMenu">	
						<div data-role="controlgroup" data-type="horizontal"  class="ui-nodisc-icon" style="background:#e9e9e9" align="center">
							<a href="#sequencePage" data-theme="b" data-role="button" data-icon="arrow-l" data-iconpos="notext" onclick="shotSet[selectedShot] = saveMessToShot(); shotSet[selectedShot].thumb = threeCanvas.toDataURL(); shotSet[selectedShot].scriptobj = $('#textbox-Script').val();">Back</a>
							<a href="#" data-role="button" data-icon="preset" data-iconpos="notext" class="ui-nodisc-icon" onclick="$('#mobileMenu').hide();$('#shotPresetPage').show()">Preset</a>
							<a href="#" data-role="button" data-icon="camera" data-iconpos="notext" onclick="$('#mobileMenu').hide();$('#shotCameraPage').show()">Camera</a>
							<a href="#" data-role="button" data-icon="lighting" data-iconpos="notext" onclick="$('#mobileMenu').hide();$('#shotLightingPage').show()">Lighting</a>
							<a href="#" data-role="button" data-icon="stage" data-iconpos="notext" onclick="$('#mobileMenu').hide();$('#shotStagePage').show()">Stage</a>
						</div>

						<div data-role="controlgroup" data-type="horizontal"  class="ui-nodisc-icon" style="background:#e9e9e9" align="center">
							<a href="#" data-role="button" data-icon="cast" data-iconpos="notext" onclick="$('#mobileMenu').hide();$('#shotCastPage').show()">Cast</a>
							<a href="#" data-role="button" data-icon="acting" data-iconpos="notext" onclick="$('#mobileMenu').hide();$('#shotActingPage').show()">Acting</a>
							<a href="#" data-role="button" data-icon="props" data-iconpos="notext" onclick="$('#mobileMenu').hide();$('#shotPropsPage').show()">Props</a>
							<a href="#" data-role="button" data-icon="script" data-iconpos="notext" onclick="$('#mobileMenu').hide();$('#shotScriptPage').show()">Script</a>
							<a href="#" data-role="button" data-icon="advanced" data-iconpos="notext" onclick="$('#mobileMenu').hide();$('#shotAdvancedPage').show()">Advanced</a>
						</div>
					</div>

					<script>
						$( "#shotPage" ).on( "pagebeforeshow", function( event ) {
							console.log("#shotPage pagebeforeshow event fired");
							console.log("selectedShot is " + selectedShot);
							//$('#shotHeader').html("Shot 1." + (selectedShot+1));
							$('#shotHeader').html("1." + (selectedShot+1));
						} );
					</script>
					<style>
						#shotHeader {
							font-size: 4em;
							padding-top:0;
							margin-top:-1.5em;
							position: relative;
							top:1.2em;
						}
					</style>

				</div>

				<!-- PRESET DIV -->

				<div id="shotPresetPage" class="content-secondary reduce-padding">
					<!--<div data-role="header" data-add-back-btn="true">
						<a href="#" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all" data-rel="close" onclick="$('#shotPresetPage').hide();$('#shotMenuPage').show()">Back</a>
						<h1>Preset</h1>
					</div>-->
					<ul data-role="listview" style="padding-top:1em;">
						<li data-icon="arrow-l" data-theme="b"><a href="#" onclick="$('#shotPresetPage').hide();$('#shotMenuPage').show()">Preset</a></li>
					</ul>

					<div role="main" class="ui-content" style="margin-top:1em;padding-top:1em;background-color:#e9e9e9" data-iscroll id="presetContent">

						<script>
							/* Determine which preset has been selected before applying*/
							var selectedPreset;
							var setSelectedPreset = function(id) {
								if(id==0) {selectedPreset = "empty";}
								if(id==1) {selectedPreset = "medium";}
								if(id==2) {selectedPreset = "chase";}
								if(id==3) {selectedPreset = "cowboy";}
								if(id==4) {selectedPreset = "titanic";}
								if(id==5) {selectedPreset = "default";}
							};
						</script>

						<ul data-role="listview" data-filter="true" data-filter-placeholder="Search presets...">
							<li data-icon="false"><a href="#shotPresetPopup" data-rel="popup" onclick="setSelectedPreset(0)">
								<img src="jpg/pres0.png">
								<h2>Empty</h2>
								<p>plane, void, desert</p></a>
							</li>
							<li data-icon="false"><a href="#shotPresetPopup" data-rel="popup" onclick="setSelectedPreset(1)">
								<img src="jpg/pres1.png">
								<h2>Medium shot</h2>
								<p>classic, one actor, single, ms</p></a>
							</li>
							<li data-icon="false"><a href="#shotPresetPopup" data-rel="popup" onclick="setSelectedPreset(2)">
								<img src="jpg/pres2.png">
								<h2>Chase</h2>
								<p>running, action, two people</p></a>
							</li>
							<li data-icon="false"><a href="#shotPresetPopup" data-rel="popup" onclick="setSelectedPreset(3)">
								<img src="jpg/pres3.png">
								<h2>Cowboy shot</h2>
								<p>western, duel, showdown</p></a>
							</li>
							<li data-icon="false"><a href="#shotPresetPopup" data-rel="popup" onclick="setSelectedPreset(4)">
								<img src="jpg/pres4.png">
								<h2>Cameron</h2>
								<p>romantic, iceberg, warning</p></a>
							</li>
							<li data-icon="false"><a href="#shotPresetPopup" data-rel="popup" onclick="setSelectedPreset(5)">
								<img src="jpg/pres5.png">
								<h2>Test shot</h2>
								<p>two people, waving, standing, medium</p></a>
							</li>	
						</ul>
						<div data-role="popup" id="shotPresetPopup" data-overlay-theme="b" class="ui-content" padding-bottom:2em;>
							<p>This will overwrite the current shot.</p>
							<form>
								<input type="button" value="Apply Preset" onclick="applyPreset(selectedPreset); $('#shotPresetPopup').popup('close')">
								<input type="button" value="Apply Camera" disabled="">
								<input type="button" value="Apply Acting" disabled="">
							</form>	
						</div>							

					</div><!-- /content -->
				</div><!-- /panel -->

				<!-- CAMERA PANEL -->

				<div id="shotCameraPage" class="content-secondary">
					<!--<div data-role="header" data-add-back-btn="true">
						<a href="#" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all" data-rel="close" onclick="$('#shotCameraPage').hide();$('#shotMenuPage').show()">Back</a>
						<h1>Camera</h1>
					</div>-->
					<ul data-role="listview" style="padding-top:1em;">
						<li data-icon="arrow-l" data-theme="b"><a href="#" onclick="$('#shotCameraPage').hide();$('#shotMenuPage').show()">Camera</a></li>
					</ul>

					<div role="main" class="ui-content" style="padding-top:2em;background-color:#e9e9e9">


							<input type="checkbox" name="checkbox-CameraManual" id="checkbox-CameraManual" onchange="toggleOrbitControls()" checked="checked">
							<label for="checkbox-CameraManual">Manual adjustment</label>

							<p>Quick jump:</p>
							<div>
								<ul data-role="listview" style="padding-bottom:2em;padding-top:1em">
									<li>
										<a onclick="controls.target = new THREE.Vector3(0,1.7,0);">Light center</a>
									</li>
									<li>
										<a onclick="controls.target = new THREE.Vector3(actorModel[0].position.x,1.6,actorModel[0].position.z);">Actor 1</a>
									</li>
									<li>
										<a onclick="controls.target = new THREE.Vector3(actorModel[1].position.x,1.6,actorModel[1].position.z);">Actor 2</a>
									</li>
									<li>
										<a onclick="controls.target = new THREE.Vector3((actorModel[1].position.x+actorModel[0].position.x)/2,1.6,(actorModel[1].position.z+actorModel[0].position.z)/2)">Mid-point</a>
									</li>											
								</ul>
							</div>						

							<label for="slider-CameraAngle">Pan horizontally</label>
							<input type="range" name="slider-CameraAngle" id="slider-CameraAngle" min="-0.1" max="0.1" step="0.01" value="0" disabled="">

							<label for="slider-CameraTilt">Pan vertically</label>
							<input type="range" name="slider-CameraTilt" id="slider-CameraTilt" min="-0.1" max="0.1" step="0.01" value="0" disabled="">	

							<label for="slider-CameraFOV">Field Of View</label>
							<input type="range" name="slider-CameraFOV" id="slider-CameraDOF" min="0" max="180" value="45" disabled="">			
	
					</div><!-- /content -->

					<script>
						/* Collect input from sliders & buttons */
						/*var sliderCameraAngle = $("#slider-CameraAngle").val();
					
						$("#button-ZoomIn").on("click", function(){
							setCameraZoom(true, 1.2);
						});
						$("#button-ZoomOut").on("click", function(){
							setCameraZoom(false, 1.2);
						});*/
					</script>

				</div><!-- /page-div -->

				<!-- LIGHTING PANEL -->

				<div id="shotLightingPage" class="content-secondary">
					<!--<div data-role="header">
						<a href="#" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all" data-rel="close" onclick="$('#shotLightingPage').hide();$('#shotMenuPage').show()">Back</a>
						<h1>Lighting</h1>
					</div>-->

					<ul data-role="listview" style="padding-top:1em;">
						<li data-icon="arrow-l" data-theme="b"><a href="#" onclick="$('#shotLightingPage').hide();$('#shotMenuPage').show()">Lighting</a></li>
					</ul>					

					<div role="main" class="ui-content" style="padding-top:3em;background-color:#e9e9e9">
						
							<ul data-role="listview" data-icon="false" data-filter-placeholder="Search presets...">
								<li><a href="#" data-rel="popup">
									<img src="jpg/empty.jpg">
								<h2>Three-point</h2>
								<p>Demo lighting</p></a>
								</li>
							</ul>

						<div style="margin-top:3em;margin-right:0em">

							<label for="slider-LightingAmbientActors">Ambient (actors)</label>
							<input type="range" name="slider-LightingAmbientActors" id="slider-LightingAmbientActors" min="0" max="1" step="0.01" onchange="setAmbientActors($('#slider-LightingAmbientActors').val())">
							<label for="slider-LightingAmbientStage">Ambient (stage)</label>
							<input type="range" name="slider-LightingAmbientStage" id="slider-LightingAmbientStage" min="0" max="1" disabled="">

							<label for="slider-LightingDirecational">Directional intensity</label>
							<input type="range" name="slider-LightingDirectional" id="slider-LightingDirectional" min="0" max="5" step="0.1" onchange="setDirectionalIntensity($('#slider-LightingDirectional').val())">
							<label for="slider-LightingTemperature">Temperature</label>
							<input type="range" name="slider-LightingTemperature" id="slider-LightingTemperature" step="100" min="1500" max="12000" value="5600" onchange="setTemperature($('#slider-LightingTemperature').val())">

						</div>
									
					</div><!-- /content -->
					<script>

						$("#shotLightingPage").on( 'show', function( event, ui ){
							console.log("bob");
							for(var i=0; i<filmLightHelper.length; i++){
								scene.add(filmLightHelper[i]);
							}
						});
						$("#shotLightingPage").on( 'hide', function(){
							console.log("obo");
							for(var i=0; i<filmLightHelper.length; i++){
								scene.remove(filmLightHelper[i]);
							}
						});

						//$("#slider-LightingAmbientActors").val(0.5).slider().slider("refresh"); //temporary solution, will always show as defaults
						//$("#slider-LightingDirectional").val(2.5).slider().slider("refresh");

					</script>
				</div><!-- /div-page -->

				<!-- STAGE PANEL -->

				<div id="shotStagePage" class="content-secondary">
					<!--<div data-role="header">
						<a href="#" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all" data-rel="close" onclick="$('#shotStagePage').hide();$('#shotMenuPage').show()">Back</a>
						<h1>Stage</h1>
					</div>-->

					<ul data-role="listview" style="padding-top:1em;">
						<li data-icon="arrow-l" data-theme="b"><a href="#" onclick="$('#shotStagePage').hide();$('#shotMenuPage').show()">Stage</a></li>
					</ul>	

					<div role="main" class="ui-content" style="padding-top:2em;background-color:#e9e9e9">
						<form>

							<input type="button" value="Upload from file..." id="button-StageUpload" data-icon="arrow-u" disabled="">
							<input type="button" data-icon="camera" value="Take from camera..." id="button-StageCamera" disabled="">

							<p>Stage library</p>

							<ul data-role="listview" data-icon="false" data-split-theme="a" data-filter="true" data-inset="true" data-filter-placeholder="Search library...">
								<li><a href="#" data-rel="popup">
									<img src="jpg/empty.jpg">
								<h2>Empty</h2>
								<p>Simple plane</p></a>
								</li>
							</ul>								

							<label for="slider-StageRotation">Rotate stage</label>
							<input type="range" name="slider-StageRotation" id="slider-StagRotation" min="0" max="100" value="50" disabled="">

							<label for="picker-StageColor">Background color</label>
							<input type="text" class="color {hash:true,pickerFaceColor:'transparent',pickerFace:3,pickerBorder:0,pickerInsetColor:'#999999,adjust:false'}" name="picker-StageColor" id="picker-StageColor" onchange="console.log($('#picker-StageColor').val());setBackgroundColor($('#picker-StageColor').val())">
							
							<script>
								
							</script>

						</form>			
					</div><!-- /content -->
				</div><!-- /div-page -->

				<!-- CAST PANEL -->

				<div id="shotCastPage" class="content-secondary">
					<!--<div data-role="header">
						<a href="#" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all" data-rel="close" onclick="$('#shotCastPage').hide();$('#shotMenuPage').show()">Back</a>
						<h1>Cast</h1>
					</div>-->

					<ul data-role="listview" style="padding-top:1em;">
						<li data-icon="arrow-l" data-theme="b"><a href="#" onclick="$('#shotCastPage').hide();$('#shotMenuPage').show()">Cast</a></li>
					</ul>	

					<div role="main" class="ui-content" style="padding-top:3em;background-color:#e9e9e9">

						<ul data-role="listview" id="actorList">
							<li data-icon="false"><a href="#shotCastNewPopup" data-rel="popup" onclick="selectedModel = 0;">
								<img src="jpg/plane.jpg">
								<h2>Slot 1</h2>
								<p></p></a>
							</li>
							<li data-icon="false"><a href="#shotCastNewPopup" data-rel="popup" onclick="selectedModel = 1;">
								<img src="jpg/plane.jpg">
								<h2>Slot 2</h2>
								<p></p></a>
							</li>
							<li data-icon="false"><a href="#shotCastNewPopup" data-rel="popup" onclick="selectedModel = 2;">
								<img src="jpg/plane.jpg">
								<h2>Slot 3</h2>
								<p></p></a>
							</li>
							<li data-icon="false"><a href="#shotCastNewPopup" data-rel="popup" onclick="selectedModel = 3;">
								<img src="jpg/plane.jpg">
								<h2>Slot 4</h2>
								<p></p></a>
							</li>
							<li data-icon="false"><a href="#shotCastNewPopup" data-rel="popup" onclick="selectedModel = 4;">
								<img src="jpg/plane.jpg">
								<h2>Slot 5</h2>
								<p></p></a>
							</li data-icon="false">
							<li data-icon="false"><a href="#shotCastNewPopup" data-rel="popup" onclick="selectedModel = 5;">
								<img src="jpg/plane.jpg">
								<h2>Slot 6</h2>
								<p></p></a>
							</li>									
						</ul>
						<div data-role="popup" id="shotCastPopup" data-overlay-theme="b" class="ui-content" padding-bottom:2em;>
							<form>
								<input type="button" value="Pick model" onclick="$('#shotCastPopup').popup().popup('close');setTimeout(function(){$('#shotCastNewPopup').popup().popup('open')},100)"></a>
								<input type="button" value="Reposition" onclick="startPositioningMode(selectedModel)">
								<input type="button" value="Remove from this shot" onclick="removeActorFromShot(selectedModel);$('#shotCastPopup').popup().popup('close');$('#shotCastPage').hide();$('#shotCastPage').show();">
								<div class="ui-grid-d">
									<div class="ui-block-a">
										<input type="button" style="background: #ff0000;opacity:1" onclick="setModelColor(selectedModel,0xff0000)">
									</div>
									<div class="ui-block-b">
										<input type="button" style="background: #ffff00;opacity:1" onclick="setModelColor(selectedModel,0xffff00)">
									</div>
									<div class="ui-block-c">
										<input type="button" style="background: #00ff00;opacity:1" onclick="setModelColor(selectedModel,0x00ff00)">
									</div>
									<div class="ui-block-d">
										<input type="button" style="background: #00ffff;opacity:1" onclick="setModelColor(selectedModel,0x00ffff)">
									</div>
									<div class="ui-block-e">
										<input type="button" style="background: #0000ff;opacity:1" onclick="setModelColor(selectedModel,0x0000ff)">
									</div>
									<div class="ui-block-a">
										<input type="button" style="background: #ffffff;opacity:1" onclick="setModelColor(selectedModel,0xffffff)">
									</div>
									<div class="ui-block-b">
										<input type="button" style="background: #cccccc;opacity:1" onclick="setModelColor(selectedModel,0xcccccc)">
									</div>
									<div class="ui-block-c">
										<input type="button" style="background: #888888;opacity:1" onclick="setModelColor(selectedModel,0x888888)">
									</div>
									<div class="ui-block-d">
										<input type="button" style="background: #444444;opacity:1" onclick="setModelColor(selectedModel,0x444444)">
									</div>
									<div class="ui-block-e">
										<input type="button" style="background: #000000;opacity:1" onclick="setModelColor(selectedModel,0x000000)">
									</div>											
								</div>
							</form>
						</div>
						<div data-role="popup" id="shotCastNewPopup" data-overlay-theme="b" class="ui-content" padding-bottom:2em;>
							
							<div class="ui-grid-a">
								<div class="ui-block-a">
									<p><b>Pick model and color:</b></p>
								</div>
								<div class="ui-block-b">
									<input class="color {hash:true,pickerFaceColor:'transparent',pickerFace:3,pickerBorder:0,pickerInsetColor:'#999999'}" name="picker-ModelColor" id="picker-ModelColor" onchange="setModelColor(selectedModel,$('#picker-ModelColor').val())">
								</div>
							</div><!-- /grid-a -->
							
							<ul data-role="listview" data-filter="true" data-filter-placeholder="Search presets..." data-inset="true">
								<li><a href="#" onclick="if(actorModel[selectedModel]==undefined){addActorToShot(defaultPath,0,0,0,0);startPositioningMode(selectedModel)}$('#shotCastNewPopup').popup().popup('close');">
									<img src="jpg/defmodel.jpg">
								<h2>Test model</h2>
								<p>The basic model available for this demonstration.<br> Includes 20 poses.</p></a>
								</li>
								<li><a href="#" onclick="">
									<img src="jpg/plane.jpg">
								<h2>(Unavailable)</h2>
								<p>Future models can be added by project contributors.</p></a>
								</li>										
							</ul>

							<input type="button" value="Go back" onclick="$('#shotCastNewPopup').popup().popup('close')">					
						</div>																

						<script>
							var selectedModel;

							$("#shotCastPage").on( "show", function( event, ui ){
							/*Assuming only the default models are implemented*/
							for(var i=0; i<actorModel.length; i++){
								if(actorModel[i] != undefined){
									$("#actorList").children().eq(i).children().eq(0).children().eq(0).attr("src","jpg/defmodel.jpg")
									$("#actorList").children().eq(i).children().eq(0).children().eq(1).html("Model "+(i+1));
									$("#actorList").children().eq(i).children().eq(0).children().eq(2).html("Using test model.");
									$("#actorList").children().eq(i).children().eq(0).attr("href","#shotCastPopup");
									console.log("new panel options added");
								}
							}
							for(var i=0; i<6; i++){ //for every list slot
								if(actorLoader[i] == undefined){
									$("#actorList").children().eq(i).children().eq(0).children().eq(0).attr("src","jpg/plane.jpg")
									$("#actorList").children().eq(i).children().eq(0).children().eq(1).html("Slot "+(i+1));
									$("#actorList").children().eq(i).children().eq(0).children().eq(2).html("");
									$("#actorList").children().eq(i).children().eq(0).attr("href","#shotCastNewPopup");
								}
							}
						});
							
						var storeMenu;

						var startPositioningMode = function(whichModel) {
							selectedModel = whichModel;
							storeMenu = $('#shotCastPage').html();
							$('#shotCastPage').html("<p><b>Click</b> or <b>tap</b> on the scene to position the actor/actress.</p><p>Before releasing, you can <b>drag horizontally</b> to rotate the model.</p><p>If you're using a mouse, you can still scroll to dolly in and out.</p>");
							raycasterEnabled = true;
							scene.add( pointerCube );
							$('#shotCastPopup').popup().popup('close');
							//$('#shotCastPage').hide();
							//$('#shotMenuPage').show();
						};

						var endPositioningMode = function() {
							//$('#shotMenuPage').hide();
							//$('#shotCastPage').show();
							scene.remove( pointerCube );
							$('#statusOverlay').html("Free camera<br><span>drag to adjust view</span>");
							$('#statusOverlay').css('background-color','#000');
							$('#shotCastPage').html(storeMenu);
							$("#shotCastPage").hide();
							$("#shotCastPage").show();//trigger the onshow update
						};
						</script>

					</div><!-- /content -->
				</div><!-- /page-div -->

				<!-- ACTING PANEL -->

				<div id="shotActingPage" class="content-secondary">
					<!--<div data-role="header">
						<a href="#" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all" data-rel="close" onclick="$('#shotActingPage').hide();$('#shotMenuPage').show()">Back</a>
						<h1>Acting</h1>
					</div>-->

					<ul data-role="listview" style="padding-top:1em;">
						<li data-icon="arrow-l" data-theme="b"><a href="#" onclick="$('#shotActingPage').hide();$('#shotMenuPage').show()">Acting</a></li>
					</ul>					

					<div role="main" class="ui-content" style="padding-top:3em;background-color:#e9e9e9">

						<ul data-role="listview" data-split-icon="acting" data-split-theme="a" id="actorPoseList">
							<li><a href="#" data-rel="popup" onclick="selectedModel = 0;">
								<img src="jpg/plane.jpg">
								<h2>Slot 1</h2>
								<p></p></a>
								<a onclick="$('#shotActingFacePopup').popup().popup('open')">Expression</a>
							</li>
							<li><a href="#" data-rel="popup" onclick="selectedModel = 1;">
								<img src="jpg/plane.jpg">
								<h2>Slot 2</h2>
								<p></p></a>
								<a onclick="$('#shotActingFacePopup').popup().popup('open')">Expression</a>
							</li>
							<li><a href="#" data-rel="popup" onclick="selectedModel = 2;">
								<img src="jpg/plane.jpg">
								<h2>Slot 3</h2>
								<p></p></a>
								<a onclick="$('#shotActingFacePopup').popup().popup('open')">Expression</a>
							</li>
							<li><a href="#" data-rel="popup" onclick="selectedModel = 3;">
								<img src="jpg/plane.jpg">
								<h2>Slot 4</h2>
								<p></p></a>
								<a onclick="$('#shotActingFacePopup').popup().popup('open')">Expression</a>
							</li>
							<li><a href="#" data-rel="popup" onclick="selectedModel = 4;">
								<img src="jpg/plane.jpg">
								<h2>Slot 5</h2>
								<p></p></a>
								<a onclick="$('#shotActingFacePopup').popup().popup('open')">Expression</a>
							</li>
							<li><a href="#" data-rel="popup" onclick="selectedModel = 5;">
								<img src="jpg/plane.jpg">
								<h2>Slot 6</h2>
								<p></p></a>
								<a onclick="$('#shotActingFacePopup').popup().popup('open')">Expression</a>
							</li>									
						</ul>
						<div data-role="popup" id="shotActingPopup" data-overlay-theme="b" class="ui-content" padding-bottom:2em;>
							<form>
								<input type="button" value="option1" onclick="" disabled="">
								<input type="button" value="option2" onclick="" disabled="">
								<input type="button" value="option3" onclick="" disabled="">
							</form>
						</div>
						<div data-role="popup" id="shotActingPosePopup" data-overlay-theme="b" class="ui-content" padding-bottom:2em; data-iscroll>
		
							<ul data-role="listview" data-filter="true" data-filter-placeholder="Search presets..." data-inset="true">
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[0])">
									<img src="jpg/arm-raised.jpg">
								<h2>Arm raised</h2>
								<p>pointing, assertive, objection</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[1])">
									<img src="jpg/bowing.jpg">
								<h2>Bow</h2>
								<p>bending, performing</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[2])">
									<img src="jpg/cradle.jpg">
								<h2>Cradle</h2>
								<p>holding, arms crossed</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[3])">
									<img src="jpg/generic.jpg">
								<h2>Generic</h2>
								<p>arm extended, step, unbalanced</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[4])">
									<img src="jpg/holding.jpg">
								<h2>Holding</h2>
								<p>shooting, aiming</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[5])">
									<img src="jpg/kneeling.jpg">
								<h2>Kneeling</h2>
								<p>resting, crouching</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[6])">
									<img src="jpg/leaping.jpg">
								<h2>Leaping</h2>
								<p>jumping, falling, flying</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[7])">
									<img src="jpg/pulling-1arm.jpg">
								<h2>Pulling arm</h2>
								<p>swinging, fist fighting, punching</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[8])">
									<img src="jpg/resting-side.jpg">
								<h2>Resting side</h2>
								<p>laying on ground, down, sleeping</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[9])">
									<img src="jpg/resting-down.jpg">
								<h2>Resting up</h2>
								<p>laying on ground, down, sleeping</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[10])">
									<img src="jpg/running.jpg">
								<h2>Running</h2>
								<p>rushing, jogging, away</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[11])">
									<img src="jpg/sitting-rest.jpg">
								<h2>Seated laid back</h2>
								<p>sitting, resting, relaxing</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[12])">
									<img src="jpg/sitting-cross.jpg">
								<h2>Seated cross-legged</h2>
								<p>sitting, relaxed, crossing legs</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[13])">
									<img src="jpg/standing.jpg">
								<h2>Standing</h2>
								<p>normal, generic, upright</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[14])">
									<img src="jpg/walking.jpg">
								<h2>Walking</h2>
								<p>pacing, stepping, strolling</p></a>
								</li>
								<li><a href="#" onclick="applyActingPose(selectedModel,sketchupGuy[15])">
									<img src="jpg/waving.jpg">
								<h2>Waving</h2>
								<p>standing, raising hand, calling</p></a>
								</li>
							</ul>
						</div>

						<div data-role="popup" id="shotActingFacePopup" data-overlay-theme="b" class="ui-content" padding-bottom:2em;>
							<p>Facial expressions are unavailable for this model.</p>
							<p>This feature is not yet available.</p>
							<input type="button" value="Go back" onclick="$('#shotActingFacePopup').popup().popup('close')">
						</div>

					</div>						
				</div><!-- /panel -->

				<script>
					var selectedModel;
					var selectedPose;

					$("#shotActingPage").on( "show", function( event, ui ){

						console.log("panel open event triggered");
						for(var i=0; i<actorModel.length; i++){
							if(actorModel[i] != undefined){
								$("#actorPoseList").children().eq(i).children().eq(0).children().eq(0).attr("src","jpg/defmodel.jpg")
								$("#actorPoseList").children().eq(i).children().eq(0).children().eq(1).html("Actor " + (i+1));
								$("#actorPoseList").children().eq(i).children().eq(0).children().eq(2).html("Pose selection");
								$("#actorPoseList").children().eq(i).children().eq(0).attr("href","#shotActingPosePopup");
								console.log("new panel options added");
							}
						}
						for(var i=0; i<6; i++){ //for every list slot
							if(actorLoader[i] == undefined){
								$("#actorPoseList").children().eq(i).children().eq(0).children().eq(0).attr("src","jpg/plane.jpg")
								$("#actorPoseList").children().eq(i).children().eq(0).children().eq(1).html("Slot "+(i+1));
								$("#actorPoseList").children().eq(i).children().eq(0).children().eq(2).html("");
								$("#actorPoseList").children().eq(i).children().eq(0).attr("href","#");
							}
						}

					});

				</script>			

				<!-- PROPS PANEL -->

				<div id="shotPropsPage" class="content-secondary">
					<!--<div data-role="header">
						<a href="#" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all" data-rel="close" onclick="$('#shotPropsPage').hide();$('#shotMenuPage').show()">Back</a>
						<h1>Props</h1>
					</div>-->

					<ul data-role="listview" style="padding-top:1em;">
						<li data-icon="arrow-l" data-theme="b"><a href="#" onclick="$('#shotPropsPage').hide();$('#shotMenuPage').show()">Props</a></li>
					</ul>						

					<div role="main" class="ui-content" style="padding-top:2em;background-color:#e9e9e9">
						<p>This feature isn't available yet.</p>
						<p>It would allow placing basic geometric shapes on the scene, such as walls or chairs.</p>
						<p>Support for more Collada (.dae) models is planned for detailed props - newspapers, weapons, etc.</p>
					</div><!-- /content -->
				</div><!-- /panel -->

				<!-- SCRIPT PANEL -->

				<div id="shotScriptPage" class="content-secondary">
					<!--<div data-role="header">
						<a href="#" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all" data-rel="close" onclick="$('#shotScriptPage').hide();$('#shotMenuPage').show()">Back</a>
						<h1>Script</h1>
					</div>-->

					<ul data-role="listview" style="padding-top:1em;">
						<li data-icon="arrow-l" data-theme="b"><a href="#" onclick="$('#shotScriptPage').hide();$('#shotMenuPage').show()">Script</a></li>
					</ul>						

					<div role="main" class="ui-content" style="padding-top:2em;background-color:#e9e9e9">
						<form>
							<!--<input type="text" id="textbox-Script" value="Shot description..." style="line-height: 8;">-->

							<textarea cols="10" rows="8" name="textarea" id="textbox-Script" placeholder="Shot description..."></textarea>

							<input type="checkbox" name="checkbox-ScriptAudio" id="checkbox-ScriptAudio" disabled="">
							<label for="checkbox-ScriptAudio">Include sound box</label>

							<input type="text" id="textbox-ScriptAudio" disabled="" value="Audio description..." style="line-height: 8;">

							<input type="checkbox" name="checkbox-ScriptZoom" id="checkbox-ScriptZoom" disabled="">
							<label for="checkbox-ScriptZoom">Include zoom info</label>

							<input type="text" id="textbox-ScriptZoom" disabled="" value="Custom...">
						</form>			
					</div><!-- /content -->
				</div><!-- /panel -->

				<!-- ADVANCED POPUP -->

				<div id="shotAdvancedPage" class="content-secondary">
					<!--<div data-role="header">
						<a href="#" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all" data-rel="close" onclick="$('#shotAdvancedPage').hide();$('#shotMenuPage').show()">Back</a>
						<h1>Advanced</h1>
					</div>-->

					<ul data-role="listview" style="padding-top:1em;">
						<li data-icon="arrow-l" data-theme="b"><a href="#" onclick="$('#shotAdvancedPage').hide();$('#shotMenuPage').show()">Advanced</a></li>
					</ul>						

					<div role="main" class="ui-content" style="padding-top:2em;background-color:#e9e9e9">
						<p>Merge two shots together to show motion:</p>

						<input type="button" value="Composite shot creator..." id="button-AdvancedMerge" disabled="">

						<p>Use mouse, tablet or touchscreen to add your own details on top of the rendered scene:</p>

						<input type="button" value="Annotate..." id="button-AdvancedAnnotate">

						<p>Export this shot only as an image file; save on your computer/device or cloud:</p>

						<input type="button" value="Export this shot..." id="button-AdvancedExport">

					</div><!-- /content -->
					<script>

						$('#button-AdvancedExport').on("click", function(){
							console.log("Taking screenshot...");
							var screenshot = advancedExportShot();
							//console.log(advancedExportShot());
							window.open(screenshot);
						});

						$('#button-AdvancedAnnotate').on("click", function(){
							advancedAnnotateShot();
						});

					</script>
				</div><!-- /div-page -->

				<!-- SKETCHING PANEL -->

				<div id="shotSketchPage" class="content-secondary">
					<div data-role="header">
						<!--<a href="#" class="ui-btn-left ui-btn ui-btn-inline ui-mini ui-corner-all" data-rel="close" onclick="$('#shotAdvancedPage').hide();$('#shotMenuPage').show()">Back</a>-->
						<h1>Annotation</h1>
					</div><!-- /header -->

					<div role="main" class="ui-content">
						<p>Use your mouse, tablet or touchscreen to draw on top of the shot.<br>Click on one of the buttons below when you're ready.</p>

						<a href="#sequencePage" data-role="button" id="button-saveDrawing">Save drawing</a>

						<a href="#" data-role="button" id="button-clearDrawing" onclick="advancedAnnotateClear()">Clear</a>

						<a href="#" data-role="button" id="button-discardDrawing" onclick="advancedAnnotateDiscard()">Discard</a>

					</div><!-- /content -->
					<script>

						$('#button-saveDrawing').on("click", function(){
							shotSet[selectedShot] = saveMessToShot();
							shotSet[selectedShot].thumb = $('#simple_sketch').get(0).toDataURL();
						});

						$('#button-discardDrawing').on("click", function(){
							//
						});

					</script>
				</div><!-- /div-page -->				

			</div><!-- /content -->

		</div><!-- /shotpage -->

		<script>
			//============ G L O B A L   V A R I A B L E S ============

			var manualControls = true; // to check if OrbitControls should be enabled
			var soundBox = true; // extra information in storybord view
			var zoomBox = true; // extra information in storyboard view

			var defaultPath = 'dae/3D_Man_Standing.dae'; // for quick default model access

			var actorModel = new Array(); // store all actor models in the shot...
			var actorLoader = new Array(); // ...and their corresponding ColladaLoaders
			var filmLight = new Array();
			var filmLightHelper = new Array();

			//=========================================================

			//========= C A N V A S   A N D   R E N D E R E R =========
			
			window.scrollTo(0,1); //quick fix for browser view on mobile

			/* Global Variables */
			var demoAnimation = false;
			var aspect = 0.5625; //default 0.5625 = 16:9 ratio
			var sideBarWidth = 0.2; //percentage; default 178/1280dp

			var pointerDetectRay, projector, mouse2D; //for raycasting (mouse picking)

			var rendererWidth;
			var rendererHeight;

			var raycasterEnabled = false;
			var rotationEnabled = false;

			var scene = new THREE.Scene();
			/* Vertical field of view 45 simulating a general consumer camera */
			var camera = new THREE.PerspectiveCamera( 45, 16/9, 0.1, 1000 );

			var renderer = new THREE.WebGLRenderer({
				preserveDrawingBuffer: true, // required to support .toDataURL() but expected to affect performance on some devices
				shadowMapEnabled: true, // required to enable shadows
				antialias: true
			});

			/* Detect screen orientation and affect variables */

			var portrait = false;

			if (matchMedia) {
				var mq = window.matchMedia("(min-width: 900px)");
				mq.addListener(WidthChange);
				WidthChange(mq);
			}
			function WidthChange(mq) {
				if (mq.matches) {
					portrait = false;
				}
				else {
					portrait = true;
				}
			}

			/* Resize Renderer to account for sidebar */

			if(portrait){
				rendererWidth = window.innerWidth;
				rendererHeight = window.innerWidth*aspect;
				renderer.setSize( rendererWidth, rendererHeight);
				$('#topBorder').hide();
				$('#bottomBorder').hide();
				$('#shotHeader').hide();
				$('#menuListview').hide();
				$('#shotMenuHeader').hide();
				$('#mobileMenu').show();				
			}
			else{
				rendererWidth = window.innerWidth*0.8;
				rendererHeight = window.innerWidth*aspect*0.8;
				renderer.setSize( rendererWidth, rendererHeight);
				$('#topBorder').show();
				$('#bottomBorder').show();
				$('#shotHeader').show();
				$('#bottomBorder').height(window.innerHeight - rendererHeight - $('#topBorder').height() - 4);
				$('#menuListview').show();
				$('#shotMenuHeader').show();
				$('#mobileMenu').hide();
			}

			/* Insert Renderer into DOM */

			//document.getElementById("shotPrevPage").insertBefore( renderer.domElement, document.getElementById("shotPrevPage").firstChild );
			document.getElementById("shotPrevPage").insertBefore( renderer.domElement, document.getElementById("shotPrevPage").childNodes[2]);
			var threeCanvas = renderer.domElement;
			threeCanvas.id = "threeCanvasId";

			/* Adjust Renderer size on window resize & orientation change */

			window.onresize = function(){
				if(portrait){
					rendererWidth = window.innerWidth;
					rendererHeight = window.innerWidth*aspect;
					renderer.setSize( rendererWidth, rendererHeight);
					$('#topBorder').hide();
					$('#bottomBorder').hide();
					$('#shotHeader').hide();
					$('#menuListview').hide();
					$('#shotMenuHeader').hide();
					$('#mobileMenu').show();
				}
				else{
					rendererWidth = window.innerWidth*0.8;
					rendererHeight = window.innerWidth*aspect*0.8;
					renderer.setSize( rendererWidth, rendererHeight);
					$('#topBorder').show();
					$('#bottomBorder').show();
					$('#shotHeader').show();
					$('#bottomBorder').height(window.innerHeight - rendererHeight - $('#topBorder').height() - 4);
					$('#menuListview').show();
					$('#shotMenuHeader').show();
					$('#mobileMenu').hide();
				}
			};

			/* Initialise mouse picker */
			pointerDetectRay = new THREE.Raycaster();
			pointerDetectRay.ray.direction.set(0, -1, 0);
			projector = new THREE.Projector();
			mouse2D = new THREE.Vector3(0, 0, 0);

			//=========================================================	

			//========= O B J E C T S   F O R   T E S T I N G =========

			/* Ground plane*/
			var geometry2 = new THREE.PlaneGeometry( 20, 20 );
			var material2 = new THREE.MeshBasicMaterial( {color: 0x999999, side: THREE.DoubleSide} ); //change to lambert for receiving shadows
			var plane = new THREE.Mesh( geometry2, material2 );
			plane.rotation.x = Math.PI/2;
			plane.receiveShadow = true;
			scene.add( plane );

			//=========================================================

			//==================== L I G H T I N G ====================

			/* Initialise Ambient Light and set to non-preset default */
			var light = new THREE.AmbientLight( 0x000000 ); //soft white
			scene.add(light);

			/* Initialise Single Directional Light for testing */
			var spotLight, spotLightHelper;

			//=========================================================

			//============== O R B I T   C O N T R O L S ==============

			/* Set OrbitControls on camera, restrict input to canvas */
			var controls = new THREE.OrbitControls(camera,threeCanvas);
			controls.damping = 0.2;
			controls.addEventListener('change',render);

			//=========================================================

			//============== R E N D E R E D   S H O T S ==============

			var renderedShot = [];
			var renderedShotTemp;

			//=========================================================

			//============= O B J E C T   S E L E C T O R =============

			//handling the raycaster picker

			//=========================================================

			//======= R E S P O N S I V E   W E B   D E S I G N =======

			//functions which transform the elements when in portrait

			//=========================================================

			//============= R E N D E R   F U N C T I O N =============

			/* Some functions are required to be inside this loop */

			var render = function () {
			//	pointerDetectRay = pointerDetectRay.setFromCamera(mouse2D.clone(), camera); //mouse picker
				requestAnimationFrame( render );
				controls.update();
				/* Orbit around target just to look cool */
				if (demoAnimation) {
					controls.autoRotate = true;
					controls.autoRotateSpeed = 3.0;
				}
				renderer.render(scene, camera);
			};
			render();

			//=========================================================

			//============ R A Y C A S T E R   P I C K E R ============
			
			/*It's slightly off but it will have to do*/
			
			var pointerGeometry = new THREE.BoxGeometry( 0.1, 0.1, 0.1 );
			var pointerMaterial = new THREE.MeshBasicMaterial( {color: 0x000000} );
			var pointerCube = new THREE.Mesh( pointerGeometry, pointerMaterial );

			var prevMouseX;
			
			//scene.add( pointerCube );
			var vector = new THREE.Vector3();

			$(threeCanvasId).mousemove(function(event){
				if(raycasterEnabled){
					if(portrait){
						vector.set((event.clientX / rendererWidth ) * 2 - 1, - ( event.clientY / rendererHeight ) * 2 + 1, 0.5 );
					}
					else {
						vector.set(((event.clientX - rendererWidth/4) / rendererWidth) * 2 - 1, - ( event.clientY / rendererHeight ) * 2 + 1, 0.5 );
					}
					vector.unproject( camera );
					var dir = vector.sub( camera.position ).normalize();
					var distance = - camera.position.y / dir.y;
					var pos = camera.position.clone().add( dir.multiplyScalar( distance ) );
					console.log(pos);
					console.log(event.clientX);

					pointerCube.position.x = pos.x;
					pointerCube.position.z = pos.z;

					if(selectedModel!=undefined) {
						actorModel[selectedModel].position.x = pos.x;
						actorModel[selectedModel].position.z = pos.z;
					}
				}
				if(rotationEnabled){
					console.log("Rotation mode");
					if (event.clientX < prevMouseX) {
						var r = actorModel[selectedModel].rotation.y
						actorModel[selectedModel].rotation.y = r - 0.1;
					}
					else if (event.clientX > prevMouseX) {
						var r = actorModel[selectedModel].rotation.y
						actorModel[selectedModel].rotation.y = r + 0.1;
					}
					prevMouseX = event.clientX;
				}
			});

			$(threeCanvasId).mousedown(function(event){

				if(raycasterEnabled){
					controls.enabled = false;
					raycasterEnabled = false;
					rotationEnabled = true;
					prevMouseX = event.clientX;
				}

			});

			$(threeCanvasId).mouseup(function(event){

				if(rotationEnabled){
					rotationEnabled = false;
					console.log("End rotation");
					controls.enabled = true;
					endPositioningMode();
				}

			});

			//=========================================================

			//=========== O B J E C T S   ( S T O R A G E ) ===========

			var actorSet = [];
			var lightSet = [];
			var propSet = [];

			var shotSet = [];

			function ActorObj (xpos,ypos,zpos,yrot,model,pose,color) {
				this.xpos = xpos;
				this.ypos = ypos;
				this.zpos = zpos;
				this.yrot = yrot;
				this.model = model;
				this.pose = pose;
				this.color = color;
			};

			function SpotlightObj (x,y,z,tx,ty,tz){
				this.x = x;
				this.y = y;
				this.z = z;
				this.tx = tx;
				this.ty = ty;
				this.tz = tz;
			};

			function CameraObj (x,y,z,tx,ty,tz,fov){
				this.x = x;
				this.y = y;
				this.z = z;
				this.tx = tx;
				this.ty = ty;
				this.tz = tz;
				this.fov = fov;
			};

			function LightingObj (lightset,lightstrength,spotlightstrength,lighttemp){
				this.lightset = lightset;
				this.lightstrength = lightstrength;
				this.spotlightstrength = spotlightstrength;
				this.lighttemp = lighttemp;
			};

			function StageObj (picture,model,yrot,color){
				this.picture = picture;
				this.model = model;
				this.yrot = yrot;
				this.color = color;
			};

			function PropObj (){
				//not available
			};

			function ScriptObj (script,audio,zoom){
				this.script = script;
				this.audio = audio;
				this.zoom = zoom;
			};

			function ShotObj (actorset,propset,cameraobj,lightingobj,stageobj,manual,scriptobj) {
				this.actorset = actorset;
				this.propset = propset;

				this.cameraobj = cameraobj;
				this.lightingobj = lightingobj;
				this.stageobj = stageobj;
				this.scriptobj = scriptobj;

				manual = this.manual;

				thumb = threeCanvas.toDataURL();
			};

			/*Won't save ambient light and temperature yet, replaces with defaults*/
			/*Model and POSE also get ignored*/
			var saveMessToShot = function() {

				var thisActorSet = [];
				for(var i = 0; i<actorModel.length; i++) {
					var thisActor = new ActorObj(
						actorModel[i].position.x,
						actorModel[i].position.y,
						actorModel[i].position.z,
						actorModel[i].rotation.y,
						0, //model
						0, //pose
						actorModel[i].children[0].children[0].material.materials[0].color
					);
					thisActorSet.push(thisActor);
				}
				var thisPropSet = [];
				var thisCameraObj = new CameraObj(
					camera.position.x,
					camera.position.y,
					camera.position.z,
					controls.target.x,
					controls.target.y,
					controls.target.z
				);
				var thisLightSet = [];
				for(var i = 0; i<filmLight.length; i++) {
					var thisLight = new SpotlightObj(
						filmLight[i].position.x,
						filmLight[i].position.y,
						filmLight[i].position.z,
						filmLight[i].target.position.x,
						filmLight[i].target.position.y,
						filmLight[i].target.position.z
					);
					thisLightSet.push(thisLight);
				}
				var thisLightingObj = new LightingObj(
					thisLightSet,
					0.5, //ambient intensity goes here, temporary
					filmLight[0].intensity,
					4500 //temperature goes here, temporary
				);
				var thisStageObj = new StageObj(
					null, //picture
					0, //model
					0, //rotation
					renderer.getClearColor()
				);
				var thisScriptObj = new ScriptObj("in production","in production","XX");

				var thisShot = new ShotObj(thisActorSet,thisPropSet,thisCameraObj,thisLightingObj,thisStageObj,controls.enabled,thisScriptObj);
				
				return thisShot;
			};

			var loadMessFromShot = function(obj) {
				/* Wipe actors from scene */
				removeActorFromShot(5);
				removeActorFromShot(4);
				removeActorFromShot(3);
				removeActorFromShot(2);
				removeActorFromShot(1);
				removeActorFromShot(0);
				actorLoader.length = 0;
				actorModel.length = 0;
				/* Wipe lights from scene */
				scene.remove(filmLight[0]);
				scene.remove(filmLight[1]);
				scene.remove(filmLight[2]);
				scene.remove(filmLight[3]); // temp. solution
				filmLight.length = 0;
				filmLightHelper.length = 0;
				/* Remove test lights */
				scene.remove(spotLight);
				scene.remove(spotLightHelper);
				/* Wipe props from scene */
				//not necessary

				for(var i=0; i<obj.actorset.length; i++) {
					addActorToShot(
						obj.actorset[i].pose,
						obj.actorset[i].xpos,
						obj.actorset[i].ypos,
						obj.actorset[i].zpos,
						//obj.actorset[i].yrot
						0 //temp.
					);
				}
				for(var i=0; i<obj.lightingobj.lightset.length; i++) {
					addLightToShot(
						obj.lightingobj.lightset[i].x,
						obj.lightingobj.lightset[i].y,
						obj.lightingobj.lightset[i].z,
						obj.lightingobj.lightset[i].tx,
						obj.lightingobj.lightset[i].ty,
						obj.lightingobj.lightset[i].tz
					);
				}
			};

			var createSequence = function(preshots) {
				shotSet.length = 0;
				for(var i=0;i<preshots;i++) {
					shotSet[i] = new ShotObj(null,null,null,null,null,null,null);
					shotSet[i].thumb = "jpg/0.png"
				};
			}

			//=========================================================

			//=================== F U N C T I O N S ===================

			/* Print list of all present actors and loaders for debugging */
			var printActors = function(howMany) {
				for (var i=0; i<howMany; i++) {
					console.log("ACTOR " + i);
					console.log("  loader:" + actorLoader[i]);
					console.log("  model: " + actorModel[i]);
				}
			}

			var printLights = function(howMany) {
				for (var i=0; i<howMany; i++) {
					console.log("LIGHT" + i);
					console.log("  spotLight:" + filmLight[i]);
				}
			}

			var saveActor = function(number) {
				var actor = {
					xpos : actorModel[number].position.x,
					ypos : actorModel[number].position.y,
					zpos : actorModel[number].position.z,
					yrot : actorModel[number].rotation.y,
					color : "",
					model : "default",
					pose : "default",
				};
				if(actorModel[number].children[0].children[0].material.materials[0] != undefined){
						actor.color = actorModel[number].children[0].children[0].material.materials[0].color;
					}
					else{
						actor.color = actorModel[number].children[0].children[0].material.color;
					}
				return actor;
			}

			$(document).click(function() {
				if( $('#shotActingPosePopup').hasClass("ui-popup-active") == true ){
					$('#statusOverlay').html("Camera locked<br><span>a popup is open</span>");
					$('#statusOverlay').css('background-color','#770000');
				}else{
					$('#statusOverlay').html("Free camera<br><span>Drag to adjust view</span>");
					$('#statusOverlay').css('background-color','#000');
				}
				if(raycasterEnabled || rotationEnabled){
					$('#statusOverlay').html("Camera locked<br><span>place actor in new position</span><br><span>drag horizontally to rotate</span>");
					$('#statusOverlay').css('background-color','#ff0000');
				}
				if(controls.enabled == false) {
					$('#statusOverlay').html("Camera locked<br><span>through manual setting</span>");
					$('#statusOverlay').css('background-color','#ff0000');					
				}
			});

	/* PRESET screen functions */

			var applyPreset = function(presetName) {

				/* Wipe actors from scene */
				scene.remove(actorModel[0]);
				scene.remove(actorModel[1]);
				scene.remove(actorModel[2]);
				scene.remove(actorModel[3]);
				scene.remove(actorModel[4]);
				scene.remove(actorModel[5]); // temp. solution
				actorLoader.length = 0;
				actorModel.length = 0;

				/* Clear lighting (only works for single test light) */
				scene.remove(spotLight);
				scene.remove(spotLightHelper);
				render();

				/* Consider changing this to switch: case */
				if (presetName == "default") {

					/* Actors */
					addActorToShot('dae/3D_Man_Waving.dae',-0.7,0,0,0);
					addActorToShot('dae/3D_Man_Standing.dae',0.7,0,0,0);

					/* Camera position and target*/
					camera.position.x = 0; //- to orbit left + to orbit right
					camera.position.y = 1.7; //- to orbit down + to orbit up
					camera.position.z = 1.2; //- to zoom in + to zoom out

					controls.target = new THREE.Vector3(0,1.7,0.5);
					//X: - target to left + target to right
					//Y: - target to down + target to up
					//Z: - target further away + target closer (tricky to wrap head around)

					/* Default light */
					threePointLight();

					/* Background Color */
					setBackgroundColor(0xcccccc);

				}
				else if (presetName == "empty") {

					camera.position.x = 0;
					camera.position.y = 1.7;
					camera.position.z = 1.5;
					controls.target = new THREE.Vector3(0,1.7,0);
					threePointLight();
					setBackgroundColor(0xcccccc);

				}
				else if (presetName == "medium") {

					addActorToShot('dae/3D_Man_Standing.dae',0,0,0,0);
					camera.position.x = 0;
					camera.position.y = 1.55;
					camera.position.z = 1.3;
					controls.target = new THREE.Vector3(0,1.55,0);
					threePointLight();
					setBackgroundColor(0xcccccc);

				}				
				else if (presetName == "chase") {

					addActorToShot('dae/3D_Man_Running.dae',-0.07,0,0.55,-1.3);
					addActorToShot('dae/3D_Man_Running.dae',8.82,0,-2.64,-1);

					camera.position.x = -1.37;
					camera.position.y = 1.24;
					camera.position.z = 0.28;
					controls.target = new THREE.Vector3(-0.39,1.23,0.25);
					threePointLight();
					setBackgroundColor(0xcccccc);

				}
				else if (presetName == "titanic") {

					addActorToShot('dae/3D_Man_Kneeling.dae',-0.378,0,0.05,0.4);
					addActorToShot('dae/3D_Man_Seated_Laidback.dae',-0.174,0.1,0.852,0);

					camera.position.x = -0.729;
					camera.position.y = 0.923;
					camera.position.z = 1.31;
					controls.target = new THREE.Vector3(0.051,1.13,0.356);
					threePointLight();
					setBackgroundColor(0xc76108);

				}				
				else if (presetName == "cowboy") {

					/* Workaround to get one of actors stand up */
					var newLoader = new THREE.ColladaLoader();
					newLoader.options.convertUpAxis = true;
					newLoader.load('dae/3D_Man_Resting_Up.dae', function (collada) {
						var newModel = collada.scene;
						newModel.position.set(-3,0,0);
						newModel.rotation.x = Math.PI/2;
						newModel.rotation.z = Math.PI/-2;					
						scene.add(newModel);
						actorModel.push(newModel);		
					})
					actorLoader.push(newLoader);

					/* Second actor can be loaded normally */
					addActorToShot('dae/3D_Man_Standing.dae',3,0,0,Math.PI/-2);

					/* Camera position and target */
					controls.target = new THREE.Vector3(3,1,-1);
					camera.position.set(-3.13,1.07,0.54);

					/* Lights and helper (dirty code, implement proper functions) */
					//spotLight = new THREE.SpotLight( 0xffffff, 200, 100, Math.PI/3);
					//spotLight.position.set(0,5,0);
					//spotLight.target.position.set(0,0,0);
					//spotLightHelper = new THREE.SpotLightHelper(spotLight);
					//scene.add(spotLight);
					//scene.add(spotLightHelper);
					threePointLight();
					//render();


					/* Background color */
					setBackgroundColor(0xcccccc);

				}
				else {console.log("Preset not found");} //this will still wipe the lights & actors
				
			};

	/* CAMERA screen functions */

			var applyPresetCam = function(zoom) {
				controls.target.y = 1.85;

				if (zoom == 'XCU') {
					translate = 0.3;
					newHeight = 1.8;
				}
				else if (zoom == 'CU') {
					translate = 0.5;
					newHeight = 1.8;
				}
				else if (zoom == 'MS') {
					controls.target.y = 1.55;
					translate = 1.3;
					newHeight = 1.55;
				}
				else if (zoom == 'LS') {
					controls.target.y = 1;
					translate = 3;
					newHeight = 1.5;
				}

				camera.position.x = controls.target.x;
				camera.position.y = newHeight;
				camera.position.z = controls.target.z + translate;
			};

			var setCameraRotation = function(radians) {
				/*radians; -PI to +PI */
				controls.rotateLeft(radians);
			};

			var setCameraZoom = function(isZoomOut, scale){
				if(isZoomOut){
			 		controls.dollyIn(scale);
				}else{
					controls.dollyOut(scale);
				}
			};

			var setCameraTilt = function(radians) {
				/*radians; -PI to +PI */
				controls.rotateUp(radians);
			};

			var toggleOrbitControls = function() {
				if ($('#checkbox-CameraManual').prop("checked")) {
					controls.enabled = true;
					$('#statusOverlay').html("Camera unlocked<br><span></span>");
					$('#statusOverlay').css('background-color','#770000');
				}
				else {
					controls.enabled = false;
					$('#statusOverlay').html("Camera locked<br><span></span>");
					$('#statusOverlay').css('background-color','#ff0000');
				}
			}

			/*doesn't work properly*/
			var toggleFreeCam = function() {
				if (!controls.enabled){
					controls.enabled = true;
					if ($('#checkbox-CameraManual').prop("checked")) {
							$("#checkbox-CameraManual").click();
						}
					$('#statusOverlay').html("Free camera<br><span>drag to adjust view</span>");
					$('#statusOverlay').css('background-color','#000');
				}
				else {
					controls.enabled = false;
					if (!$('#checkbox-CameraManual').prop("checked")) {
						$("#checkbox-CameraManual").click();
					}
					$('#statusOverlay').html("Camera locked<br><span>click and drag to position actors</span>");
					$('#statusOverlay').css('background-color','#ff0000');
				}
			}

			var setFieldOfView = function(newFov) {
				camera.fov = newFov; //doesn't work
				camera.update();
			};

			var storeCamera = function() {
				var thisCam = new CameraObj(camera.position.x,camera.position.y,camera.position.z,controls.target.x,controls.target.y,controls.target.z,45);
				return thisCam;
			};

			var restoreCamera = function(camObj) {
				camera.position.set(camObj.x,camObj.y,camObj.z);
				controls.target.set(camObj.tx,camObj.ty,camObj.tz);
			}

	/*LIGHTING screen functions */

			var addLightToShot = function(x,y,z,tx,ty,tz) {

				var newLight = new THREE.SpotLight (0xffffff);
				newLight.position.set(x,y,z);
				newLight.target.position.set(tx,ty,tz);

				newLight.castShadow = true;

				//newLight.shadowMapWidth = 1024;
				//newLight.shadowMapHeight = 1024;

				//newLight.shadowCameraNear = 0;
				//newLight.shadowCameraFar = 4000;
				//newLight.shadowCameraFov = 30;

				newLight.shadowCameraVisible = true;

				var newLightHelper = new THREE.SpotLightHelper(newLight,0.1);

				scene.add(newLight);
				//scene.add(newLightHelper);
				render();
				filmLight.push(newLight);
				filmLightHelper.push(newLightHelper);
			};

			var removeLightFromShot = function(number) {
				if (filmLight[number] != null) {
					scene.remove(filmLight[number]);
					scene.remove(filmLightHelper[number]);
					filmLight.splice(number,1);
					filmLightHelper.splice(number,1);
				}
				else {console.log("No such light");}
			};

			var threePointLight = function() {
				/* Wipe lights from scene */
				scene.remove(filmLight[0]);
				scene.remove(filmLight[1]);
				scene.remove(filmLight[2]);
				scene.remove(filmLight[3]); // temp. solution
				filmLight.length = 0;
				filmLightHelper.length = 0;

				/* Remove test lights */
				scene.remove(spotLight);
				scene.remove(spotLightHelper);

				/*Insert three-point light looking at center 1.7 height*/
				addLightToShot(-5,2,-5,0,1.7,5);
				addLightToShot(5,2,5,0,1.7,5);
				addLightToShot(-5,2,5,0,1.7,5);
				
				setAmbientActors(0.5);
				render();
			};

			var setAmbientActors = function(intensity) {
				//intensity range 0 to 1
				var color = new THREE.Color(intensity,intensity,intensity);
				//console.log(color.getHexString());
				light.color.setHex(color.getHex());
			};

			var setAmbientStage = function() {
				//
			};

			var applyDirectionalPreset = function() {
				//
			};

			var setDirectionalIntensity = function(newIntensity) {
				/*expected value: 0 to 1*/
				for(var i=0; i<filmLight.length; i++){
					filmLight[i].intensity = newIntensity;
					//render();
				}
			};

			var setTemperature = function(kelvins) {
				/*5600 = white, 1500=red, 12000=blue*/
				var redBias = 0;
				var blueBias = 0;
				var impact = 0.4;
				if(kelvins<5600) {
					redBias = (5600-kelvins)/5600*impact; //wow such math
				}
				else if(kelvins>5600) {
					blueBias = (kelvins-5600)/(12000-5600)*impact; //wow
				}
				var color = new THREE.Color(1-blueBias,1-(redBias+blueBias),1-redBias);
				//console.log(color);
				for(var i=0; i<filmLight.length; i++){
					filmLight[i].color.setHex(color.getHex());
					//render();
				}
				//spotLight.color.setHex(color.getHex());

				/*var tempH = color.getHSL().h;
				var tempS = color.getHSL().s;
				var tempL = color.getHSL().l;
				var oldH = plane.material.color.getHSL().h;
				var oldS = plane.material.color.getHSL().s;
				var oldL = plane.material.color.getHSL().l;

				console.log(tempH,tempS,tempL);
				plane.material.color.offsetHSL(tempH/2,tempS/2,tempL/2);*/
			};

			var setBackgroundColor = function(thisColor) {
				renderer.setClearColor(thisColor);
				plane.material.color.set(thisColor);
				/*if plane is a basic material compensate for brightness*/
				plane.material.color.offsetHSL(0,0,-0.2);

			}; //example color: 0x99ccff THE SKY IS BLUE

	/* STAGE screen functions */

			var applyStage = function() {
				//
			};

			var setStageRotation = function() {
				//
			};

			var uploadStageFromFile = function() {
				alert("Not available in preview");
			};

			var uploadStageFromCamera = function() {
				alert("Not available in preview");
			};

	/* CAST screen functions */		

			var addActorToShot = function(modelPath, x, y, z, yRot) {

				var newLoader = new THREE.ColladaLoader();
				newLoader.options.convertUpAxis = true;
				newLoader.load(modelPath, function (collada) {
					var newModel = collada.scene;
					newModel.position.set(x,y,z);
					newModel.rotation.y = yRot;
					newModel.children[0].castShadow = true;

					scene.add(newModel);
					actorModel.push(newModel);		
				})
				actorLoader.push(newLoader);
			};

			var removeActorFromShot = function(number) {
				if (actorLoader[number] != undefined) {
					scene.remove(actorModel[number]);
					actorLoader.splice(number,1);
					actorModel.splice(number,1);
				}
				else {console.log("No such actor");}
			};

			var applyActorModel = function() {
				console.log("Preview doesn't include additional models.")
			};

			var setModelColor = function(model,thisColor) {
				if (actorModel[model] != undefined) {
					if(actorModel[model].children[0].children[0].material.materials[0] != undefined) {
						actorModel[model].children[0].children[0].material.materials[0].color.set(thisColor);
					}
					else{
						actorModel[model].children[0].children[0].material.color.set(thisColor);
					}
				}
				else {
					console.log("No such actor");
				}
			};

			var setActorPosition = function(number,x,y,z) {
				if(actorModel[number] != null) {
					actorModel[number].position.x = x;
					actorModel[number].position.y = y;
					actorModel[number].position.z = z;
				}
				else {console.log("No such actor");}
			};

			var setActorRotation = function(number,radians) {
				/*default is 0, max is 2PI*/
				if(actorModel[number] != undefined) {
					actorModel[number].rotation.y = radians;
					console.log("actor " + number + " rotated " + radians + " radians");
				}
				else {console.log("Actor undefined, cannot rotate");}
			};

	/* ACTING screen functions */		

			var applyActingPose = function(number, modelPath) {
				var store = saveActor(number);
				console.log("Current actor: " + store)

				scene.remove(actorModel[number]);

				var newLoader = new THREE.ColladaLoader();
				newLoader.options.convertUpAxis = true;
				newLoader.load(modelPath, function (collada) {
					var newModel = collada.scene;
					newModel.position.set(store.xpos,store.ypos,store.zpos);
					newModel.rotation.y = store.yrot;
					newModel.children[0].castShadow = true;

					scene.add(newModel);
					actorModel[number] = newModel;		
				})
				actorLoader[number] = newLoader;
				setModelColor(number,store.color);
			};

			var applyActingFace = function() {
				//
			};

	/* PROPS screen functions */		

			var addPropToShot = function() {
				//
			};

			var removePropFromShot = function() {
				//
			};

			var applyPropModel = function() {
				//
			};

			var setPropColor = function() {
				//
			};

			var setPropPosition = function() {
				//
			};

			var setPropRotation = function() {
				//
			};

	/* SCRIPT screen functions */		

			var setShotDescription = function() {
				/*TEMPORARY SOLUTION to show up on sequence page*/

			};

			var setShotAudio = function() {
				//
			};

			var setShotZoom = function() {
				//
			};

	/* ADVANCED screen functions */		

			var advancedCompositeShot = function() {
				//
			};

			var advancedAnnotateShot = function() {

				var w = threeCanvas.width*0.97;
				var h = threeCanvas.height*0.97;

				$('#simple_sketch').attr("width",w);
				$('#simple_sketch').attr("height",h);

				$('#shotPrevPage').hide();
				$('#shotAdvancedPage').hide();
				$('#drawingDiv').show();
				$('#shotSketchPage').show();

				$('#simple_sketch').sketch();


				$('#drawingDiv').css("width","80%");

				var context = $('#simple_sketch').get(0).getContext('2d');
				var imageObj = new Image();

				imageObj.onload = function() {
					context.drawImage(imageObj, 0, 0, w, h);
				};
				
				imageObj.src = threeCanvas.toDataURL();

			};

			var advancedAnnotateClear = function() {
				var w = threeCanvas.width*0.97;
				var h = threeCanvas.height*0.97;
				$('#simple_sketch').get(0).getContext('2d').clearRect(0,0,w,h);
				$('#simple_sketch').sketch('actions',[]);
				var context = $('#simple_sketch').get(0).getContext('2d');
				var imageObj = new Image();

				imageObj.onload = function() {
					context.drawImage(imageObj, 0, 0, w, h);
				};
				
				imageObj.src = threeCanvas.toDataURL();
			}

			var advancedAnnotateDiscard = function() {
				advancedAnnotateClear();
				$('#shotSketchPage').hide();
				$('#drawingDiv').hide();
				$('#shotPrevPage').show();
				$('#shotMenuPage').show();
			}

			var advancedExportShot = function() {

				scene.remove(spotLightHelper); //hide light rays (not working for some reason)
				var dataURL = threeCanvas.toDataURL();
				scene.add(spotLightHelper); //show light rays again (not working either?!)

				return dataURL;
			};

	/* EXTRA screen functions */

			var lineMaterial = new THREE.LineBasicMaterial({
				color: 0x000000
			});
			var rectGeometry = new THREE.Geometry();
			rectGeometry.vertices.push(new THREE.Vector3(-0.16,-0.09,0));
			rectGeometry.vertices.push(new THREE.Vector3(0.16,-0.09,0));
			rectGeometry.vertices.push(new THREE.Vector3(0.16,0.09,0));
			rectGeometry.vertices.push(new THREE.Vector3(-0.16,0.09,0));
			rectGeometry.vertices.push(new THREE.Vector3(-0.16,-0.09,0));
			var inBox;
			var outBox;
			var arr0Line, arr1Line, arr2Line, arr3Line;

			//scene.add(inBox);

			var updateInBox = function() {
				scene.remove(inBox);
				inBox = new THREE.Line(rectGeometry,lineMaterial);
				scene.add(inBox);

				inBox.rotation.x = camera.rotation.x;
				inBox.rotation.y = camera.rotation.y;
				inBox.rotation.z = camera.rotation.z;

				inBox.position.x = controls.target.x;
				inBox.position.y = controls.target.y;
				inBox.position.z = controls.target.z;

				//subtract vectors to determine the distance from target
				var xdif = (controls.target.x - camera.position.x);
				var ydif = (controls.target.y - camera.position.y);
				var zdif = (controls.target.z - camera.position.z);
				var eucDis = Math.sqrt((xdif*xdif) + (ydif*ydif) + (zdif*zdif));

				console.log(eucDis);
				inBox.scale.set(eucDis*4.5,eucDis*4.5,eucDis*4.5);
			};

			var updateOutBox = function() {

				scene.remove(outBox);
				outBox = new THREE.Line(rectGeometry,lineMaterial);
				scene.add(outBox);

				outBox.rotation.x = camera.rotation.x;
				outBox.rotation.y = camera.rotation.y;
				outBox.rotation.z = camera.rotation.z;

				outBox.position.x = controls.target.x;
				outBox.position.y = controls.target.y;
				outBox.position.z = controls.target.z;

				//subtract vectors to determine the distance from target
				var xdif = (controls.target.x - camera.position.x);
				var ydif = (controls.target.y - camera.position.y);
				var zdif = (controls.target.z - camera.position.z);
				var eucDis = Math.sqrt((xdif*xdif) + (ydif*ydif) + (zdif*zdif));

				console.log(eucDis);
				outBox.scale.set(eucDis*4.5,eucDis*4.5,eucDis*4.5);

				/*var arr0Geo = new THREE.Geometry();
				arr0Geo.vertices.push(inBox.geometry.vertices[0]);
				arr0Geo.vertices.push(outBox.geometry.vertices[0]);
				arr0Line = new THREE.Line(arr0Geo,lineMaterial);

				scene.add(arr0Line);*/
			};

			var updateArrows = function() {
				//doesn't work. use annotate for now
			};

			var removeInOutBox = function() {
				scene.remove(inBox);
				scene.remove(outBox);
			};


			document.onkeydown = checkKey;

			function checkKey(e) {

				e = e || window.event;

				/* Bug: Needs to be extended for filterable listview inputs */
				if ($("#textarea").is(":focus") || $("#textbox-Script").is(":focus")) {
					console.log("A text area is in focus");
				}
				else if (e.keyCode == '49' || e.keyCode == '97') {
					console.log("1 pressed");
					controls.target = new THREE.Vector3(actorModel[0].position.x,1.6,actorModel[0].position.z);
				}
			 	else if (e.keyCode == '50' || e.keyCode == '98') {
					console.log("2 pressed");
					controls.target = new THREE.Vector3(actorModel[1].position.x,1.6,actorModel[1].position.z);
				}
				else if (e.keyCode == '51' || e.keyCode == '99') {
					console.log("3 pressed");
					controls.target = new THREE.Vector3(actorModel[2].position.x,1.6,actorModel[2].position.z);
				}
				else if (e.keyCode == '52' || e.keyCode == '100') {
					console.log("4 pressed");
					controls.target = new THREE.Vector3(actorModel[3].position.x,1.6,actorModel[3].position.z);
				}
				else if (e.keyCode == '53' || e.keyCode == '101') {
					console.log("5 pressed");
					controls.target = new THREE.Vector3(actorModel[4].position.x,1.6,actorModel[4].position.z);
				}
				else if (e.keyCode == '54' || e.keyCode == '102') {
					console.log("6 pressed");
					controls.target = new THREE.Vector3(actorModel[5].position.x,1.6,actorModel[5].position.z);
				}
				else if (e.keyCode == '55' || e.keyCode == '103') {
					console.log("7 pressed");
					controls.target = new THREE.Vector3(actorModel[6].position.x,1.6,actorModel[6].position.z);
				}
				else if (e.keyCode == '56' || e.keyCode == '104') {
					console.log("8 pressed");
					controls.target = new THREE.Vector3(actorModel[7].position.x,1.6,actorModel[7].position.z);
				}
				else if (e.keyCode == '57' || e.keyCode == '105') {
					console.log("9 pressed");
					controls.target = new THREE.Vector3(actorModel[8].position.x,1.6,actorModel[8].position.z);
				}
				else if (e.keyCode == '48' || e.keyCode == '96') {
					console.log("0 pressed");
					controls.target = new THREE.Vector3(0,1.7,0);
				}
				else if (e.keyCode == '189' || e.keyCode == '109') {
					console.log("- pressed");
					setCameraZoom(false, 1.2);
				}
				else if (e.keyCode == '187' || e.keyCode == '107') {
					console.log("+ pressed");
					setCameraZoom(true, 1.2);
				}
				else if (e.keyCode == '73') {
					console.log("I pressed");
					updateInBox();
				}
				else if (e.keyCode == '79') {
					console.log("O pressed");
					updateOutBox();
				}
				else if (e.keyCode == '80') {
					console.log("P pressed");
					removeInOutBox();
				}
				else if (e.keyCode == '88') {
					console.log("X pressed");
					applyPresetCam('XCU');
				}
				else if (e.keyCode == '67') {
					console.log("C pressed");
					applyPresetCam('CU');
				}
				else if (e.keyCode == '86') {
					console.log("V pressed");
					applyPresetCam('MS');
				}
				else if (e.keyCode == '66') {
					console.log("B pressed");
					applyPresetCam('LS');
				}
			}

			/* Apply the first preset (doesn't work at beginning of code) */

			applyPreset("empty");

			//=========================================================

			//======= C O L L A D A   M O D E L S   ( . D A E ) =======

			/* Paths to DAE models, range 0-15 (extra 4 models don't work yet*/

			var sketchupGuy = [ "dae/3D_Man_Arm Raised.dae", "dae/3D_Man_Bow.dae", "dae/3D_Man_Cradle.dae", "dae/3D_Man_Generic_Pose.dae", "dae/3D_Man_Holding.dae", "dae/3D_Man_Kneeling.dae", "dae/3D_Man_Leaping.dae", "dae/3D_Man_Pulling_1Arm.dae", "dae/3D_Man_Resting_Side.dae", "dae/3D_Man_Resting_Up.dae", "dae/3D_Man_Running.dae", "dae/3D_Man_Seated_Laidback.dae", "dae/3D_Man_Seated_Leg_Crossed.dae", "dae/3D_Man_Standing.dae", "dae/3D_Man_Walking.dae", "dae/3D_Man_Waving.dae", ];

			//problematic models: "dae/3D_Man_Dancing.dae","dae/3D_Man_Pulling.dae",dae/3D_Man_Resting_Prone.dae","dae/3D_Man_Seated.dae"

			//=========================================================

		</script>

	</body>
</html>